<!DOCTYPE html>
<html>
    <head>
        <title>Create a JET</title>
        <style>
            .form-container {
                max-width: 30rem;
                margin: 2rem auto;
                padding: 2rem;
                background-color: #fff;
                border: 1px solid #d2d2d2;
                border-radius: 4px;
            }

            .logo {
                width: 200px;
                height: auto;
                margin-bottom: 2rem;
            }

            .product-name {
                font-size: 1.5rem;
                font-weight: bold;
                margin-bottom: 2rem;
            }

            .form-group {
                margin-bottom: 1rem;
            }

            .form-group label {
                font-weight: bold;
            }

            .form-group input[type="email"],
            .form-group input[type="text"] {
                width: 100%;
                padding: 0.5rem;
                border-radius: 4px;
                border: 1px solid #d2d2d2;
            }

            .radio-group {
                display: flex;
                align-items: center;
                margin-bottom: 1rem;
            }

            .radio-group label {
                margin-right: 1rem;
            }

            .submit-button {
                background-color: #cc0000;
                color: #fff;
                padding: 0.5rem 1rem;
                border: none;
                border-radius: 4px;
                font-weight: bold;
                cursor: pointer;
            }

            .submit-button:hover {
                background-color: #a80000;
            }
        </style>
    </head>
    <body>
        <div class="logo">
            <!-- Placeholder for your logo -->
        </div>
        <div class="product-name">
            Jira Easy Task (JET)
        </div>

        <div class="form-container">
            <h1>Create Devprod Merge Request Jira</h1>

            <form id="jiraForm">
                <div class="form-group">
                    <label for="email">Email Address:</label>
                    <input type="email" id="email" name="email" required>
                </div>

                <div class="form-group">
                    <label for="summary">Summary:</label>
                    <input type="text" id="summary" name="summary" required>
                </div>

                <div class="form-group">
                    <label for="type">Quick select task type:</label>
                    <div class="radio-group">
                        <input type="radio" id="maintenance" name="type" value="maintenance">
                        <label for="maintenance">Maintenance</label>
			<input type="radio" id="general" name="type" value="general">
                        <label for="general">General</label>
			<input type="radio" id="merge-request" name="type" value="merge-request" checked>
                        <label for="merge-request">Merge request</label>
                        <input type="radio" id="toil" name="type" value="toil">
                        <label for="toil">Toil</label>
                    </div>
                </div>

                <button type="submit" class="submit-button">Create Jira</button>
	</form>
		
	<script>
		const form = document.getElementById('jiraForm');
		form.addEventListener('submit', createJiraTask);

		async function createJiraTask(event) {
			event.preventDefault();
			const email = document.getElementById('email').value;
			const type = document.querySelector('input[name="type"]:checked').value;
			const summary = document.getElementById('summary').value;
			const url = 'https://issues.redhat.com/rest/api/2/issue';
			const payload = JSON.stringify({
				"fields": {
					"project": {
						"key": "RHCLOUD"
					},
					"issuetype": {
						"name": "Task"
					},
					"priority": {
						"name": "Normal"
					},
					"summary": `${type} | ${summary}`,
					"labels": ["platform-devprod", "merge-request", type.toLowerCase()],
					"assignee": {
						"emailAddress": email
					}
				}
			});

			try {
				const response = await fetch(url, {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
						'Authorization': 'Bearer API-KEY'
					},
					body: payload
				});

				if (response.ok) {
					const data = await response.json();
					const issueId = data.key;
					const issueLink = data.self;
					alert(`Jira task created successfully!\nIssue ID: ${issueId}\nIssue Link: ${issueLink}`);
				} else {
					const error = await response.json();
					alert(`Jira task creation failed: ${error.errors.assignee}`);
				}
			} catch (error) {
				alert(`Jira task creation failed: ${error}`);
			}
		}
	</script>
            
	</body>
</html>
